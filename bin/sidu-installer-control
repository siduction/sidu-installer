#! /bin/bash
CMD=$1
test -n "$CMD" || CMD=start

case "$1" in                                                                                                            
start)
	pywwetha-control $CMD
	sidu-base-control $CMD
	if [ -n "${DISPLAY}" ] ; then
	# Launches x-www-browser if we are in kde, xfce, lxde, rqt, gnome
		BROWSER=x-www-browser
		LINK=/usr/bin/$BROWSER
		while [ True ] ; do
			LINK=$(readlink $LINK)
			test -z "$LINK" && break
			if [ $(expr $LINK : "[.][.]") != 0 ] ; then
				LINK=/usr/bin/$LINK
			fi
			BROWSER=$LINK
		done
		# at this moment we allow the chromium browser:
		BLOCKED_BROWSER=chromiumX
		if [ $(expr $BROWSER : ".*$BLOCKED_BROWSER" ) != 0  ] ; then
			test -x /usr/bin/midori && BROWSER=/usr/bin/midori
			test -x /usr/bin/iceweasel && BROWSER=/usr/bin/iceweasel
			if [ $(expr $BROWSER : ".*$BLOCKED_BROWSER") != 0 ] ; then
				xmessage "$BLOCKED_BROWSER has a bug avoiding that sidu-installer works. No alternative browser found. Please install midori (or similar) ..."
			fi
		fi 
	else
	# Launches www-browser (elinks) if we are in nox
		BROWSER=www-browser
	fi
	$BROWSER http://sidu-installer:8086
	;;
stop)
	sidu-base-control $CMD
	pywwetha-control $CMD
	;;                                                                                                              
*)                                                                                                                      
        echo "unknown command! Use start stop."                                            
        exit 1                                                                                                          
        ;;                                                                                                              
esac                                                                                                                    
