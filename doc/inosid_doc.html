<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="doc.css">
<title>Documentation of InOSid</title>
</head>
<body>

<!---===TOC===-->
<div class="toc">
<ul>
	<li><a href="#C1_">1. Introduction</a></li>
	<li><a href="#C1_1_">1.1. Purpose</a></li>
	<li><a href="#C1_2_">1.2. Architecture</a></li>
	<li><a href="#C1_3_">1.3. Pure http</a></li>
	<li><a href="#C1_4_">1.4. Navigation</a></li>
	<li><a href="#C2_">2. Plugins</a></li>
	<li><a href="#C2_1_">2.1. Tasks of a Plugin</a></li>
	<li><a href="#C2_2_">2.2. Methods to Overwrite (always)</a></li>
	<li><a href="#C2_3_">2.3. Methods to Overwrite (optional)</a></li>
	<li><a href="#C2_4_">2.4. Plugin services</a></li>
	<li><a href="#C3_">3. Page Template</a></li>
	<li><a href="#C3_1_">3.1. Markers</a></li>
	<li><a href="#C4_">4. Content Template</a></li>
	<li><a href="#C4_1_">4.1. Markers</a></li>
	<li><a href="#C5_">5. Configuration</a></li>
	<li><a href="#C5_1_">5.1. Global Configuration Data</a></li>
	<li><a href="#C5_2_">5.2. User Data</a></li>
	<li><a href="#C6_">6. Data flow</a></li>
	<li><a href="#C6_1_">6.1. Setting the Input Fields</a></li>
	<li><a href="#C6_2_">6.2. Field Validation</a></li>
	<li><a href="#C7_">7. I18n</a></li>
	<li><a href="#C8_">8. Conventions</a></li>
</ul>
</div>
<!---===TOC===-->
<h1><a name="C1_">1.</a> Introduction</h1>
<p>This document describes the project inosid for developers.</p>

<h2><a name="C1_1_">1.1.</a> Purpose</h2>
<p>inosid provides a GUI for the siduction installer.</p>

<h2><a name="C1_2_">1.2.</a> Architecture</h2>
<p>This is a <strong>template and plugin</strong> driven approach
which can be extended and modified easily.</p>
<p>There is a skeleton offering flow control, handling of
configuration, storing of user specific data and so on.</p>
<p>Each page of the application is handled by a plugin implemented
by a class derived from Page to administrate this page.</p>
<p>The basic html page is defined in a template. The content area of
the page will be created from the plugin.<br />
This allows using one template for all pages (equal design).</p>

<h2><a name="C1_3_">1.3.</a> Pure http</h2>
<p>This application does its job without Java Script. In my opinion
a web application should run without java script. Only additional things
can be done by JS.</p>

<h2><a name="C1_4_">1.4.</a> Navigation</h2>
<p>The standard http process only allows access to the input field
values if a button inside the form has been pushed. Therefore the
navigation uses buttons instead of links.</p>
<p>Without this construction the user must push a "store" button and
the data will be lost if he does not (very uncomfortable).</p>
<p>With the navigation by buttons the plugin can store the field
values and then it changes the page.</p>

<h1><a name="C2_">2.</a> Plugins</h1>

<h2><a name="C2_1_">2.1.</a> Tasks of a Plugin</h2>
<ul>
	<li>Builds the content area of the page.</li>
	<li>Validates the input fields.</li>
	<li>Sets the error messages.</li>
	<li>Stores the field values in the user data.</li>
</ul>
<h2><a name="C2_2_">2.2.</a> Methods to Overwrite (always)</h2>
<p>The plugin class must overwrite the abstract methods of the class
Page. See page.php.</p>

<h2><a name="C2_3_">2.3.</a> Methods to Overwrite (optional)</h2>
<p>The following methods are predefined but can be overwritten.</p>
<ul>
	<li>getTemplateName(): Return the template name. Default:
	"standard.html"</li>
	<li>getInputFields(): Returns an array with the names of the input
	fields. Default: []</li>
</ul>

<h2><a name="C2_4_">2.4.</a> Plugin services</h2>
<p>There are helper functions in the base class Page...</p>
<ul>
	<li>setReplacement(): Sets a value for a marker.</li>
	<li>setFieldError(): Sets an error message for a field if
	validation has failed.</li>
	<li>setField(): Sets a field value.</li>
	<li>i18n(): gets a language dependent string, e.g. an error
	message. Note: only for plugin specific strings.</li>
	<li>setDefaultOption(). Sets the selected option of a selection
	field. Example: NetworkPage.__construct()</li>
	<li>setEmptyToDefault(): Sets an empty text field to a default
	value. Example: NetworkPage.__construct()</li>
	<li>fillOptions(): replaces the marker ###OPT_X### (X is the
	fieldname) with the options defined in plugin.opt_x.</li>
	<li>setFieldError(): Sets an error message.</li>
	<li>setReplacement(): Prepare a replacement of a marker inside the
	content area.</li>
	<li>setField(): Sets the value of an input field.</li>
	<li>isValidContent(): Tests character set of a field value.</li>
	<li>validPassword(): Checks a password.</li>
	<li>validPasswords(): Checks a pair of passwords.</li>
	<li>navigation(): Handles prev and next button.</li>
	<li>readContentTemplate(): Reads the content template().</li>
</ul>
<p>.. and in the class Session:</p>
<ul>
	<li>i18n(): gets a language dependent string, e.g. an error
	message.</li>
	<li>getField(): Returns the field value.</li>
	<li>readFileFromBase(): Loads a template.</li>
	<li>$session->userData->getValue(): Gets a value from the user
	data.</li>
	<li>$session->userData->setValue(): Puts a value into the user
	data.</li>
	<li>$session->configuration->getValue(): Gets a value from the
	configuration.</li>
</ul>

<h1><a name="C3_">3.</a> Page Template</h1>
<p>The template contains markers which will be replaced by the core
modules or the plugin.</p>
<h2><a name="C3_1_">3.1.</a> Markers</h2>
<ul>
	<li>###CONTENT### (needed): Content area. This will be replaced by
	the plugin.</li>
	<li>###INFO### (needed): An area for messages.</li>
	<li>###URL_STATIC### (optional): the URL prefix for static files,
	e.g. http://localhost/inosid/</li>
	<li>###URL_SCRIPT### (optional): the URL of the main script, e.g.
	http://localhost/inosid/install.php</li>
	<li>###URL_FORM### (optional): the URL of the form action, e.g.
	http://localhost/inosid/install.php</li>
	<li>The template must contain a &lt;form&gt; element to handle the
	buttons.</li>
	<li>There must be markers for buttons for navigating:
	###BUTTON_PREV### and ###BUTTON_NEXT###. Reason for placing markers
	instead of the button itself: The first page needs no previous button,
	the last page needs no next button. The button definitions must be set
	in the configuration: gui.button.prev and gui.button.next.</li>
	<li>###txt_x###: x is a name containing letters, digits or '_'.
	The substitution is defined in the configuration file (language
	dependent): the key is plugin.txt_x (plugin is the name of current
	plugin) or default.txt_x (for all plugins).</li>
</ul>
<h1><a name="C4_">4.</a> Content Template</h1>
<p>The content area will be filled by a plugin. It should use a
template to divide design and code. The plugin should use markers to
communicate with the template.</p>
<p>The filling of the input fields with values inserted earlier will
be done by the core modules. Therefore the names of the fields must be
known.</p>
<h2><a name="C4_1_">4.1.</a> Markers</h2>
<p>Note: X stands for an uppercase field name.</p>
<ul>
	<li>###VAL_X###: The field value must be filled by this marker.</li>
	<li>###ERROR_X###: A placeholder for the error message for the
	field X.</li>
	<li>###OPT_X###: The options of a selection field X.</li>
	<li>###txt_y###: Texts which will be replaced by values defined in
	the configuration. The key is &lt;plugin&gt;.txt_y (&lt;plugin&gt; is
	the name of the current plugin).</li>
</ul>

<h1><a name="C5_">5.</a> Configuration</h1>
<h2><a name="C5_1_">5.1.</a> Global Configuration Data</h2>
<p>The file inosid.conf contains configuration data which are used
for all clients.</p>
<pre>
# List of the page names separated by ','. 
# The series defines the effect of the Back and Next buttons.
# The page name is the name of the plugin. 
.gui.pages=home,boot,user,network,run
</pre>
<p>The configuration has a part for global definitions: these
definitions starts with '.'. The other parts are plugin dependent. The
definitions in these parts start with the plugin name.</p>

<h2><a name="C5_2_">5.2.</a> User Data</h2>
<p>When the user changes the pages (using the back or the next
button) the field values will be stored in a file. The filename is
client specific: the remote ip address is part of the name. This is not
perfect but good enough.</p>
<pre>
user.user=jonny
user.pass=123
user.pass2=123
</pre>

<h1><a name="C6_">6.</a> Data flow</h1>

<h2><a name="C6_1_">6.1.</a> Setting the Input Fields</h2>
<p>If the http header ($_GET or $_POST) contains a button the input
field will be set from the http header. Otherwise the fields will be set
from the user data. Therefore the field values in the content template
must contain markers: ###VAL_X### (X is the uppercase fieldname).</p>

<h2><a name="C6_2_">6.2.</a> Field Validation</h2>
<p>The field validation should be done inside the plugin method
onButtonClick().</p>
<p>If a field value is valid the value must be stored in user data:
<code>$this-&lt;session-&lt;userData-&lt;setValue(pluginName,
fieldName, fieldValue)</code></p>
<p>Otherwise an error message should be set: <code>$this-&lt;setFieldError(fieldName,
errorMessage)</code></p>

<h1><a name="C7_">7.</a> I18n</h1>
<p>All texts are stored in the configuration files, none in the
program code and none in the templates.</p>
<p>For each supported language there must be a configuration file.
The file name convention: &lt;name&gt;_&lt;language&gt;.&lt;ext&gt;,
e.g. inosid_de.conf</p>
<p>Templates can contain markers ###txt_X### (X is being a name with
letters, digits and '_'). Entries in the configuration must contain
&lt;plugin&gt;.txt_X or default.txt_x. &lt;plugin&gt; is the name of a
plugin. If the plugin using the template has a so defined entry this
value will be substituted. If not, the plugin independent variant will
be used.</p>

<h1><a name="C8_">8.</a> Conventions</h1>
<p>Rules are needed to integrate the plugins. For a simple
explanation, an example: user (a page asking for username and password)</p>
<ul>
	<li>Name of the plugin: user</li>
	<li>Name of the file containing the plugin class: userpage.php</li>
	<li>Name of the plugin class: UserPage</li>
	<li>Prefix of the data in the data file: "user."</li>
	<li>Name of the content template: "user.content.txt"</li>
</ul>

</body>
</html>